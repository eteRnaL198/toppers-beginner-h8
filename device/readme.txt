AKI-H8/3069F I/Oボード用デバイスドライバ

  Copyright (C) 2003-2004 by TOPPERS Project Educational Group.
  Copyright (C) 2004-2005 by Industrial Technology Institute,
                              Miyagi Prefectural Government, JAPAN

 上記著作権者は，以下の (1)〜(4) の条件か，Free Software Foundation 
 によって公表されている GNU General Public License の Version 2 に記
 述されている条件を満たす場合に限り，本ソフトウェア（本ソフトウェア
 を改変したものを含む．以下同じ）を使用・複製・改変・再配布（以下，
 利用と呼ぶ）することを無償で許諾する．
 (1) 本ソフトウェアをソースコードの形で利用する場合には，上記の著作
     権表示，この利用条件および下記の無保証規定が，そのままの形でソー
     スコード中に含まれていること．
 (2) 本ソフトウェアを，ライブラリ形式など，他のソフトウェア開発に使
     用できる形で再配布する場合には，再配布に伴うドキュメント（利用
     者マニュアルなど）に，上記の著作権表示，この利用条件および下記
     の無保証規定を掲載すること．
 (3) 本ソフトウェアを，機器に組み込むなど，他のソフトウェア開発に使
     用できない形で再配布する場合には，次のいずれかの条件を満たすこ
     と．
   (a) 再配布に伴うドキュメント（利用者マニュアルなど）に，上記の著
       作権表示，この利用条件および下記の無保証規定を掲載すること．
   (b) 再配布の形態を，別に定める方法によって，TOPPERSプロジェクトに
       報告すること．
 (4) 本ソフトウェアの利用により直接的または間接的に生じるいかなる損
     害からも，上記著作権者およびTOPPERSプロジェクトを免責すること．

 本ソフトウェアは，無保証で提供されているものである．上記著作権者お
 よびTOPPERSプロジェクトは，本ソフトウェアに関して，その適用可能性も
 含めて，いかなる保証も行わない．また，本ソフトウェアの利用により直
 接的または間接的に生じたいかなる損害に関しても，その責任を負わない．


このデバイスドライバは(株) 秋月電子通商製のAKI-H8/3069F I/Oボード上
のディップスイッチやLEDを操作する目的で作成した。
配布条件はTOPPERSライセンスに準ずる。
詳しくはhttp://www.toppers.jp/license.htmlを参照。

注）液晶表示機能を追加した（by Yokoyama, 2007/10/18）。
機能追加にあたっては、"akih8lcd_device.c", "akih8pot_device.c",
"akih8pot_device.h"を参照した。



使い方

下記のAPIは呼出側のソーフファイルでdevice.hをインクルードすると使用
できる。

(1) LEDの初期化

【C言語API】
	void initial_led(void);

【パラメータ】
	なし

【リターンパラメータ】
	なし

【機能】
LEDに接続されているI/Oポートを出力ポートとして初期化する。

(2) LEDへの出力値設定

【C言語API】
	void set_led(int led, int req);

【パラメータ】
	int led		LED番号
	int req		設定する出力値

【リターンパラメータ】
	なし

【機能】
LEDへの出力値を設定する。
事前にinitial_led()で初期化を行っておく必要がある。

パラメータledの値として
　・論理名
　　　POW_LED：		電源LED（パイロット・ランプ）
　　　TIMER_LED：	タイマLED（時刻通知LED）
　・デバイス名LED1、LED2
がマクロ定義されており、使用することができる。

パラメータreqの値として
　・ON
　・OFF
がマクロ定義されており、使用することができる。


(3) キーの初期化

【C言語API】
	void initial_key(void);

【パラメータ】
	なし

【リターンパラメータ】
	なし

【機能】
キー（ディップスイッチ）に接続されているI/Oポートを入力ポートとして初
期化する。


(4) キーの読み取り

【C言語API】
	int get_key(int sw);

【パラメータ】
	int sw		スイッチ番号

【リターンパラメータ】
	ON			スイッチがONの場合
	OFF			スイッチがOFFの場合

【機能】
キー（ディップスイッチ）の現在値を読み取る。
事前にinitial_key()で初期化を行っておく必要がある。

パラメータswの値として
　・論理名：
　　　START_SW：	タイマ起動スイッチ
　　　UP_SW：		タイマ延長スイッチ
　・デバイス名：SW1、SW2
がマクロ定義されており、使用することができる。

リターンパラメータの値として
　・ON
　・OFF
がマクロ定義されており、呼び出し側でリターンパラメータの判別に使用でき
る。


注）以下、液晶表示機能を追加した（by Yokoyama, 2007/10/18）。

(5) LCDの初期化

【C言語API】
	void initial_lcd(void);

【パラメータ】
	なし

【リターンパラメータ】
	なし

【機能】
LcD表示に必要な初期化を行う。

(6) LCDへの表示

【C言語API】
	void display_lcd(int no, char* p)

【パラメータ】
	int no		表示する行数
	char* p		表示する文字を記憶したバッファの先頭へのポインタ

【リターンパラメータ】
	なし

【機能】
LCD（液晶）への表示を行う。
液晶は２行表示可能で、１行あたり16文字表示できる。
事前にinitial_lcd()で初期化を行っておく必要がある。

パラメータnoの値は、１行表示のときは1、２行表示のときは2とする。
１行表示のときは、LCDの下の行に表示される。

パラメータpが指し示すバッファの大きさは、
１行表示のときは16バイト（16文字分）、
２行表示のときは32バイト（32文字分）必要である。
２行表示のときは最初の16文字が上の行に、残り16文字が下の行に表示される。

【注意事項】
このAPIは１つのタスクのみから呼ばれることを前提としている。
複数のタスクから呼ぶときは、セマフォを使うなどして、
呼び出しの前後で相互排除を行う必要がある。


変更履歴

2004年11月16日　(株) 秋月電子通商製の AKI-H8/3069Fに対応

2007年10月18日　液晶表示機能を追加した（by Yokoyama）
